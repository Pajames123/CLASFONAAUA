<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>The Arena | CLASFON AAUA</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-environment-component@1.3.2/dist/aframe-environment-component.min.js"></script>
    <style>
        #reg-ui { position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 5000; display: flex; align-items: center; justify-content: center; text-align: center; color: white; font-family: 'Montserrat', sans-serif; }
        .input-game { padding: 15px; background: #111; border: 1px solid #c5a059; color: white; width: 300px; text-align: center; font-size: 1.2rem; border-radius: 4px; }
        #game-controls { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); z-index: 4000; text-align: center; }
    </style>
</head>
<body>
    <div id="reg-ui">
        <div>
            <h1 style="color:#c5a059; font-family: serif; letter-spacing: 2px;">THE SCRIPTURE ARENA</h1>
            <p style="margin-bottom: 20px; opacity: 0.8;">Your victories will be recorded in the Scroll of Honor.</p>
            <input type="text" id="pName" class="input-game" placeholder="Full Name"><br><br>
            <button onclick="startArena()" style="background:#c5a059; padding:15px 40px; border:none; cursor:pointer; font-weight:bold; text-transform:uppercase;">Begin Challenge</button>
        </div>
    </div>

    <a-scene>
        <a-entity environment="preset: egypt; lighting: point; dressingAmount: 50"></a-entity>
        
        <a-entity camera look-controls wasd-controls position="0 1.6 0">
            <a-cursor color="#c5a059"></a-cursor>
        </a-entity>

        <a-entity position="0 2.2 -4">
            <a-plane width="5" height="3" color="#121214" opacity="0.9"></a-plane>
            <a-text value="WORD SCRAMBLE" align="center" position="0 1 0.1" color="#c5a059" width="6"></a-text>
            <a-text id="scrambled-display" value="L O A D I N G" align="center" position="0 0.1 0.1" scale="2.5 2.5 2.5" color="#fff"></a-text>
            <a-text id="hint-display" value="Unscramble the Biblical Term" align="center" position="0 -0.6 0.1" color="#888" width="4"></a-text>
        </a-entity>

        <a-entity position="-5 2.5 -2" rotation="0 45 0">
            <a-text value="SCROLL OF HONOR" align="center" position="0 1.2 0.1" color="#c5a059" width="5"></a-text>
            <a-text id="vr-leaderboard" value="Fetching scores..." align="center" position="0 0 0.1" width="3"></a-text>
        </a-entity>
    </a-scene>

    <div id="game-controls" style="display:none;">
        <input type="text" id="ansInput" class="input-game" placeholder="Type Answer..." style="width: 400px; border: 2px solid #c5a059;">
        <div id="xp" style="color:#c5a059; font-weight:bold; margin-top:10px; font-family: sans-serif;">XP: 0</div>
    </div>

    <script>
        const library = [
            {w: "ADVOCATE", h: "1 John 2:1 - Our Helper with the Father"}, 
            {w: "JUSTICE", h: "Deut 16:20 - What we must follow"}, 
            {w: "COVENANT", h: "A divine legal bond or agreement"},
            {w: "REDEEMER", h: "For I know that my ___ lives"},
            {w: "WITNESS", h: "Acts 1:8 - You shall be my ___"}
        ];
        let score = 0, currentW = "", pName = "";

        function startArena() {
            pName = document.getElementById('pName').value.trim();
            if(!pName) return alert("Identify yourself, Disciple.");
            document.getElementById('reg-ui').style.display = "none";
            document.getElementById('game-controls').style.display = "block";
            loadRound();
            loadLeaderboard();
        }

        function loadRound() {
            const pick = library[Math.floor(Math.random() * library.length)];
            currentW = pick.w;
            document.getElementById('scrambled-display').setAttribute('value', currentW.split('').sort(()=>Math.random()-0.5).join(' '));
            document.getElementById('hint-display').setAttribute('value', pick.h);
            document.getElementById('ansInput').value = "";
            document.getElementById('ansInput').focus();
        }

        document.getElementById('ansInput').addEventListener('input', async (e) => {
            if(e.target.value.toUpperCase() === currentW) {
                score += 10;
                document.getElementById('xp').innerText = "XP: " + score;
                // Automatic Score Submission
                await fetch('/api/save-score', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({name: pName, score: score})
                });
                loadRound();
                loadLeaderboard();
            }
        });

        async function loadLeaderboard() {
            try {
                const res = await fetch('/api/get-scores');
                const data = await res.json();
                const text = data.map((entry, i) => `${i+1}. ${entry.member} - ${entry.score} XP`).join('\n');
                document.getElementById('vr-leaderboard').setAttribute('value', text);
            } catch (e) { console.error("Leaderboard connection lost."); }
        }
    </script>
</body>
</html>